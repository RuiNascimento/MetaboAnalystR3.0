<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Jasmine Chong" />

<meta name="date" content="2020-04-15" />

<title>Statistical Analysis Module</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Statistical Analysis Module</h1>
<h4 class="author">Jasmine Chong</h4>
<h4 class="date">2020-04-15</h4>



<div id="introduction" class="section level2">
<h2>1. Introduction</h2>
<p>MetaboAnalystR, in parallel with the webserver, provides a comprehensive suite of statistical analyses to perform on a user-uploaded data set. While researchers may have several goals for their metabolomics data, the ultimate goal is to identify any significant metabolite/s indicitive of a disease state, drugs, diet, environment, geographical location, etc.</p>
<p>The standard workflow for statistical analysis is as follows:</p>
<p><strong>Processed metabolomic data -&gt; Univariate analysis -&gt; Multivariate analysis -&gt; Biological interpretation</strong></p>
<p>Univariate tests differ from multivariate tests in that they assess the importance of each variable seperately. Meanwhile, multivariate tests assess two or more variables at once, while also taking into consideration the relationship between the variables. Finally, biological interpretation provides a biological context for the significant metabolites identified using univariate/multivariate methods. Below, we will discuss the various statistical methods in greater detail. For the tutorial, we will be using a dataset consisting of concentrations of 77 urine samples from cancer patients (cachexic vs. control) measured by 1H NMR - <a href="https://link.springer.com/article/10.1007%2Fs11306-010-0232-9">Eisner et al. 2010</a>.</p>
</div>
<div id="univariate-methods" class="section level2">
<h2>2. Univariate Methods</h2>
<p>To begin the SA module, we will start with identifying important features from the data set using various univariate tests, including classical methods such as the Student’s t-test and ANOVA, as well as other methods such as the volcano plot and correlation analysis.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(MetaboAnalystR)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">mSet&lt;-<span class="kw">InitDataObjects</span>(<span class="st">&quot;conc&quot;</span>, <span class="st">&quot;stat&quot;</span>, <span class="ot">FALSE</span>);</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">mSet&lt;-<span class="kw">Read.TextData</span>(mSet, <span class="st">&quot;https://www.metaboanalyst.ca/MetaboAnalyst/resources/data/human_cachexia.csv&quot;</span>, <span class="st">&quot;rowu&quot;</span>, <span class="st">&quot;disc&quot;</span>);</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">mSet&lt;-<span class="kw">SanityCheckData</span>(mSet);</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">mSet&lt;-<span class="kw">ReplaceMin</span>(mSet);</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">mSet&lt;-<span class="kw">PreparePrenormData</span>(mSet);</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">mSet&lt;-<span class="kw">Normalization</span>(mSet, <span class="st">&quot;NULL&quot;</span>, <span class="st">&quot;LogNorm&quot;</span>, <span class="st">&quot;MeanCenter&quot;</span>, <span class="st">&quot;S10T0&quot;</span>, <span class="dt">ratio=</span><span class="ot">FALSE</span>, <span class="dt">ratioNum=</span><span class="dv">20</span>);</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">mSet&lt;-<span class="kw">PlotNormSummary</span>(mSet, <span class="st">&quot;norm_0_&quot;</span>, <span class="dt">format =</span><span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>);</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">mSet&lt;-<span class="kw">PlotSampleNormSummary</span>(mSet, <span class="st">&quot;snorm_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>);</a></code></pre></div>
<div id="fold-change-analysis" class="section level3">
<h3>2.1 Fold-change analysis</h3>
<p>The goal of fold-change (FC) analysis is to compare the absolute value of change between two group means. Since column-wise normalization (i.e. log transformation, mean-centering) will significantly alter absolute values, FC is calculated as the ratio between two group means using the data before column-wise normalization was applied.</p>
<p>For paired analysis, the program first counts the number of pairs with consistent change above the given FC threshold. If this number exceeds a given count threshold, the variable will be reported as significant.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># Perform fold-change analysis on uploaded data, unpaired</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">mSet&lt;-<span class="kw">FC.Anal.unpaired</span>(mSet, <span class="fl">2.0</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co"># Plot fold-change analysis</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">mSet&lt;-<span class="kw">PlotFC</span>(mSet, <span class="st">&quot;fc_0_&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co"># To view fold-change </span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">mSet<span class="op">$</span>analSet<span class="op">$</span>fc<span class="op">$</span>fc.log</a></code></pre></div>
</div>
<div id="t-test" class="section level3">
<h3>2.2 T-Test</h3>
<p>MetaboAnalystR supports various options for performing T-test analysis. Users can select the analysis type (<em>paired</em>), the group variance (<em>equal.var</em>), whether the test is parametric or non-parametric (<em>nonpar</em>), and the adjusted p-value (FDR) cut-off (<em>threshp</em>).</p>
<p>Note, for a large data set (&gt; 1000 variables), both the paired information and the group variance will be ignored, and the default parameters will be used for t-tests to save computational time. If you choose non-parametric tests (Wilcoxon rank-sum test), the group variance will be ignored.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># Perform T-test (parametric)</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">mSet&lt;-<span class="kw">Ttests.Anal</span>(mSet, <span class="dt">nonpar=</span>F, <span class="dt">threshp=</span><span class="fl">0.05</span>, <span class="dt">paired=</span><span class="ot">FALSE</span>, <span class="dt">equal.var=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co"># Plot of the T-test results</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">mSet&lt;-<span class="kw">PlotTT</span>(mSet, <span class="dt">imgName =</span> <span class="st">&quot;tt_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi =</span> <span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>)</a></code></pre></div>
</div>
</div>
<div id="volcano-plot" class="section level2">
<h2>2.3 Volcano Plot</h2>
<p>The volcano plot is a combination of fold change and t-test values. Note, for unpaired samples, the x-axis is log2(FC). For paired analysis, the x-axis is number of significant counts. The y-axis is -log10(p.value) for both cases, and can be based on raw or FDR adjusted p values from the t-tests. In <em>Volcano.Anal</em>, users can specify if the data are paired, the FC threshold, the comparison type, the signigicant count threshold if data are paired, whether the test is parametric or non-parametric, the p-value threshold, and the group variance.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># Perform the volcano analysis</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">mSet&lt;-<span class="kw">Volcano.Anal</span>(mSet, <span class="ot">FALSE</span>, <span class="fl">2.0</span>, <span class="dv">0</span>, <span class="fl">0.75</span>,F, <span class="fl">0.1</span>, <span class="ot">TRUE</span>, <span class="st">&quot;raw&quot;</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co"># Create the volcano plot</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">mSet&lt;-<span class="kw">PlotVolcano</span>(mSet, <span class="st">&quot;volcano_0_&quot;</span>, <span class="dv">1</span>, <span class="dt">format =</span><span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>)</a></code></pre></div>
</div>
<div id="one-way-analysis-of-variance-anova---only-for-multi-group-analysis" class="section level2">
<h2>2.4 One-way Analysis of Variance (ANOVA) - ONLY FOR MULTI-GROUP ANALYSIS!</h2>
<p>ANOVA can only be computed on data with more than one group. <strong>Please note that the below example uses data from a different example dataset.</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># Perform ANOVA</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">mSet &lt;-<span class="st"> </span><span class="kw">ANOVA.Anal</span>(mSet, F, <span class="fl">0.05</span>, <span class="st">&quot;fisher&quot;</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co"># Plot ANOVA</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">mSet &lt;-<span class="st"> </span><span class="kw">PlotANOVA</span>(mSet, <span class="st">&quot;aov_0_&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>)</a></code></pre></div>
</div>
<div id="correlation-analysis" class="section level2">
<h2>2.5 Correlation Analysis</h2>
<p>To perform correlation analysis to evaluate the correlation between all features or samples, use <em>PlotCorrHeatMap</em>. Here, users must specify the mSet object, the dimensions to be correlated, the name of the heatmap that will be created, the output, dpi, and width of the image, the distance measure (Pearson, Spearman, or Kendall), to view the heatmap as an overview or detailed view, to fix the colour distribution, the colors, and whether or not to perform clustering. Please refer to the user manual for more details.</p>
<p>Note, the heatmap will only show correlations for a maximum of 1000 features. For larger datasets, only top 1000 features will be selected based on their interquantile range (IQR). When color distribution is fixed, you can potentially compare the correlation patterns among different data sets. In this case, you can choose “do not perform clustering” for all data set, or only to perform clustering on a single reference data set, then manually re-arranged other data sets according to the clustering pattern of the reference data set.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co">### OPTION 1 - Heatmap specifying pearson distance and an overview</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">mSet&lt;-<span class="kw">PlotCorrHeatMap</span>(mSet, <span class="st">&quot;corr_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>, <span class="st">&quot;col&quot;</span>, <span class="st">&quot;pearson&quot;</span>, <span class="st">&quot;bwm&quot;</span>, <span class="st">&quot;overview&quot;</span>, F, F, F, <span class="dv">100</span>)</a></code></pre></div>
<p>The following command shows the detailed view (zoomed-in) of the above heatmap.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co">### OPTION 2 - Heatmap specifying pearson correlation and a detailed view</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">mSet&lt;-<span class="kw">PlotCorrHeatMap</span>(mSet, <span class="st">&quot;corr_1_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>, <span class="st">&quot;col&quot;</span>, <span class="st">&quot;spearman&quot;</span>, <span class="st">&quot;bwm&quot;</span>, <span class="st">&quot;detail&quot;</span>, F, F, F, <span class="dv">999</span>)</a></code></pre></div>
</div>
<div id="pattern-searching" class="section level2">
<h2>2.6 Pattern Searching</h2>
<p>Correlation analysis can be performed either against a given feature or against a given pattern. The pattern is specified as a series of numbers separated by “-”. Each number corresponds to the expected expression pattern in the corresponding group. For example, a 1-2-3-4 pattern is used to search for features that increase linearly with time in a time-series data with four time points (or four groups). The order of the groups is given as the first item in the predefined patterns. Indicate the mSet object, the distance measure (Pearson, Spearman, or Kendall), and the pattern to use.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co"># Perform correlation analysis on a pattern (a feature of interest in this case)</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">mSet&lt;-<span class="kw">FeatureCorrelation</span>(mSet, <span class="st">&quot;pearson&quot;</span>, <span class="st">&quot;1,6-Anhydro-beta-D-glucose&quot;</span>)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co"># Plot the correlation analysis on a pattern</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">mSet&lt;-<span class="kw">PlotCorr</span>(mSet, <span class="st">&quot;ptn_3_&quot;</span>, <span class="dt">format=</span><span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>)</a></code></pre></div>
</div>
<div id="principal-component-analysis-pca" class="section level2">
<h2>2.7 Principal Component Analysis (PCA)</h2>
<p>To perform PCA, first use <em>PCA.Anal</em>. MetaboAnalystR has the options to create a scree plot (<em>PlotPCAScree</em>), score plot (<em>PlotPCA2DScore</em> or <em>PlotPCA3DScore</em>), loadings plot (<em>PlotPCALoading</em>), and biplot (<em>PlotPCABiplot</em>). For the score plots, users will create both a static as well as interactive 3D score plot. To view the interactive plot, type “mSet$imgSet$pca.3d” into your R console. Please refer to the user manual for details about each function.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co"># Perform PCA analysis</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">mSet&lt;-<span class="kw">PCA.Anal</span>(mSet)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co"># Create PCA overview</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">mSet&lt;-<span class="kw">PlotPCAPairSummary</span>(mSet, <span class="st">&quot;pca_pair_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi =</span> <span class="dv">300</span>, <span class="dt">width=</span><span class="ot">NA</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb9-6" data-line-number="6"></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co"># Create PCA scree plot</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8">mSet&lt;-<span class="kw">PlotPCAScree</span>(mSet, <span class="st">&quot;pca_scree_0_&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dt">dpi =</span> <span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb9-9" data-line-number="9"></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co"># Create a 2D PCA score plot</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11">mSet&lt;-<span class="kw">PlotPCA2DScore</span>(mSet, <span class="st">&quot;pca_score2d_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">300</span>, <span class="dt">width=</span><span class="ot">NA</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="fl">0.95</span>, <span class="dv">1</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb9-12" data-line-number="12"></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="co"># Create a 3D PCA score plot</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14">mSet&lt;-<span class="kw">PlotPCA3DScoreImg</span>(mSet, <span class="st">&quot;pca_score3d_0_&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>, <span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>, <span class="dv">40</span>)</a>
<a class="sourceLine" id="cb9-15" data-line-number="15"></a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="co"># Create a PCA loadings Plots</span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17">mSet&lt;-<span class="kw">PlotPCALoading</span>(mSet, <span class="st">&quot;pca_loading_0_&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>, <span class="dv">1</span>,<span class="dv">2</span>);</a>
<a class="sourceLine" id="cb9-18" data-line-number="18"></a>
<a class="sourceLine" id="cb9-19" data-line-number="19"><span class="co"># Create a PCA Biplot</span></a>
<a class="sourceLine" id="cb9-20" data-line-number="20">mSet&lt;-<span class="kw">PlotPCABiplot</span>(mSet, <span class="st">&quot;pca_biplot_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi =</span> <span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>, <span class="dv">1</span>, <span class="dv">2</span>)</a></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># View the 3D interactive PLS-DA score plot</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">mSet<span class="op">$</span>imgSet<span class="op">$</span>pca<span class="fl">.3</span>d</a></code></pre></div>
</div>
<div id="partial-least-squares---discriminant-analysis-pls-da" class="section level2">
<h2>2.8 Partial Least Squares - Discriminant Analysis (PLS-DA)</h2>
<p>To perform PLS-DA, first use <em>PLSR.Anal</em>. MetaboAnalystR has the options to create a plot component pairs (<em>PlotPLSPairSummary</em>), score plot (<em>PlotPLS2DScore</em>), loadings plot (<em>PlotPLSLoading</em>), perform cross-validation and permutation (<em>PLSDA.CV</em> and <em>PLSDA.Permut</em>), and plot the results of the cross-validation and permutation (<em>PlotPLS.Imp</em> and <em>PlotPLS.Permutation</em>). For the score plots, users will create both a static as well as interactive 3D score plot. To view the interactive plot, type “mSet$imgSet$plsda.3d” into your R console. Please refer to the user manual for details about each function.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">mSet&lt;-<span class="kw">PLSR.Anal</span>(mSet, <span class="dt">reg=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">mSet&lt;-<span class="kw">PlotPLSPairSummary</span>(mSet, <span class="st">&quot;pls_pair_0_&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">mSet&lt;-<span class="kw">PlotPLS2DScore</span>(mSet, <span class="st">&quot;pls_score2d_0_&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>, <span class="dv">1</span>,<span class="dv">2</span>,<span class="fl">0.95</span>,<span class="dv">1</span>,<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb11-6" data-line-number="6"></a>
<a class="sourceLine" id="cb11-7" data-line-number="7">mSet&lt;-<span class="kw">PlotPLS3DScoreImg</span>(mSet, <span class="st">&quot;pls_score3d_0_&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>, <span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>, <span class="dv">40</span>)</a>
<a class="sourceLine" id="cb11-8" data-line-number="8"></a>
<a class="sourceLine" id="cb11-9" data-line-number="9">mSet&lt;-<span class="kw">PlotPLSLoading</span>(mSet, <span class="st">&quot;pls_loading_0_&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>, <span class="dv">1</span>, <span class="dv">2</span>);</a>
<a class="sourceLine" id="cb11-10" data-line-number="10"></a>
<a class="sourceLine" id="cb11-11" data-line-number="11">mSet&lt;-<span class="kw">PLSDA.CV</span>(mSet, <span class="st">&quot;T&quot;</span>,<span class="dv">5</span>, <span class="st">&quot;Q2&quot;</span>)</a>
<a class="sourceLine" id="cb11-12" data-line-number="12"></a>
<a class="sourceLine" id="cb11-13" data-line-number="13">mSet&lt;-<span class="kw">PlotPLS.Classification</span>(mSet, <span class="st">&quot;pls_cv_0_&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb11-14" data-line-number="14"></a>
<a class="sourceLine" id="cb11-15" data-line-number="15">mSet&lt;-<span class="kw">PlotPLS.Imp</span>(mSet, <span class="st">&quot;pls_imp_0_&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>, <span class="st">&quot;vip&quot;</span>, <span class="st">&quot;Comp. 1&quot;</span>, <span class="dv">15</span>,<span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb11-16" data-line-number="16"></a>
<a class="sourceLine" id="cb11-17" data-line-number="17">mSet&lt;-<span class="kw">PLSDA.Permut</span>(mSet, <span class="dv">100</span>, <span class="st">&quot;accu&quot;</span>)</a>
<a class="sourceLine" id="cb11-18" data-line-number="18"></a>
<a class="sourceLine" id="cb11-19" data-line-number="19">mSet&lt;-<span class="kw">PlotPLS.Permutation</span>(mSet, <span class="st">&quot;pls_perm_1_&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>)</a></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># View the 3D interactive PLS-DA score plot</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">mSet<span class="op">$</span>imgSet<span class="op">$</span>plsda<span class="fl">.3</span>d</a></code></pre></div>
</div>
<div id="sparse-partial-least-squares---discriminant-analysis-spls-da" class="section level2">
<h2>2.9 Sparse Partial Least Squares - Discriminant Analysis (sPLS-DA)</h2>
<p>The sparse PLS-DA (sPLS-DA) algorithm can effectively reduce the number of variables (metabolites) in high-dimensional metabolomics data to produce robust and easy-to-interpret models. Users can control the “sparseness” of the model by controlling the number of components included in the model and the number of variables within each component. More details can be found from Le Cao et. al 2011 (PMC3133555).</p>
<p>To begin, use <em>SPLSR.Anal</em>. MetaboAnalystR has the options to create an overview of the sPLS-DA analysis (<em>PlotSPLSPairSummary</em>), a score plot (<em>PlotSPLS2DScore</em> or <em>PlotSPLS3DScore</em>), loadings plot (<em>PlotSPLSLoading</em>), and classification plot (<em>PlotSPLSDA.Classification</em>). For the score plots, users will create both a static as well as interactive 3D score plot. To view the interactive plot, type “mSet$imgSet$splsda.3d” into your R console. Please refer to the user manual for details about each function. Note that the loadings plot shows the variables selected by the sPLS-DA model for a given component. The variables are ranked by the absolute values of their loadings.</p>
<p>To evaluate the performance of the created sPLS-DA models for classification, use <em>PlotSPLSDA.Classification</em>. The performance of the sPLS-DA models are evaluated using cross validations (CV) with increasing numbers of components created using the specified number of the variables. Users can choose to use either 5-fold CVs or leave one out cross-validation (LOOCV). Please note that the results from 5-fold CV may change slightly due to random subsampling procedures.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># Perform sPLS-DA analysis</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">mSet&lt;-<span class="kw">SPLSR.Anal</span>(mSet, <span class="dv">5</span>, <span class="dv">10</span>, <span class="st">&quot;same&quot;</span>, <span class="st">&quot;Mfold&quot;</span>)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co"># Plot sPLS-DA overview</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5">mSet&lt;-<span class="kw">PlotSPLSPairSummary</span>(mSet, <span class="st">&quot;spls_pair_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb13-6" data-line-number="6"></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co"># Create 2D sPLS-DA Score Plot</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8">mSet&lt;-<span class="kw">PlotSPLS2DScore</span>(mSet, <span class="st">&quot;spls_score2d_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="fl">0.95</span>, <span class="dv">1</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb13-9" data-line-number="9"></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="co"># Create 3D sPLS-DA Score Plot</span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11">mSet&lt;-<span class="kw">PlotSPLS3DScoreImg</span>(mSet, <span class="st">&quot;spls_score3d_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">40</span>)</a>
<a class="sourceLine" id="cb13-12" data-line-number="12"></a>
<a class="sourceLine" id="cb13-13" data-line-number="13"><span class="co"># Create sPLS-DA loadings plot</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14">mSet&lt;-<span class="kw">PlotSPLSLoading</span>(mSet, <span class="st">&quot;spls_loading_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>, <span class="dv">1</span>,<span class="st">&quot;overview&quot;</span>)</a>
<a class="sourceLine" id="cb13-15" data-line-number="15"></a>
<a class="sourceLine" id="cb13-16" data-line-number="16"><span class="co"># Perform cross-validation and plot sPLS-DA classification</span></a>
<a class="sourceLine" id="cb13-17" data-line-number="17">mSet&lt;-<span class="kw">PlotSPLSDA.Classification</span>(mSet, <span class="st">&quot;spls_cv_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>)</a></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co"># View the 3D interactive PLS-DA score plot</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">mSet<span class="op">$</span>imgSet<span class="op">$</span>splsda<span class="fl">.3</span>d</a></code></pre></div>
</div>
<div id="orthogonal-partial-least-squares---discriminant-analysis-orthopls-da" class="section level2">
<h2>2.10 Orthogonal Partial Least Squares - Discriminant Analysis (orthoPLS-DA)</h2>
<p>MetaboAnalystR can create several outputs for oPLS-DA analysis. To begin, use the <em>OPLSR.Anal</em> function. The outputs for oPLS-DA include a score plot, a plot to identify significant features, a model overview plot, and a plot of model permutations. For the significant features plot, the plot visualizes the variable influence in the orthogonal PLS-DA model. It combines the covariance and correlation loading profiles. This corresponds to combining the contribution or magnitude (covariance) with the effect and reliability (correlation) for the model variables with respect to model component scores (details). To begin, please use the <em>OPLSR.Anal</em> function. Please refer to the user manual for further details on the functions.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co"># Perform oPLS-DA analysis</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2">mSet&lt;-<span class="kw">OPLSR.Anal</span>(mSet, <span class="dt">reg=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="co"># Create a 2D oPLS-DA score plot</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5">mSet&lt;-<span class="kw">PlotOPLS2DScore</span>(mSet, <span class="st">&quot;opls_score2d_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>, <span class="dv">1</span>,<span class="dv">2</span>,<span class="fl">0.95</span>,<span class="dv">1</span>,<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb15-6" data-line-number="6"></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="co"># Create a significant features plot</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8">mSet&lt;-<span class="kw">PlotOPLS.Splot</span>(mSet, <span class="st">&quot;opls_splot_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>);</a>
<a class="sourceLine" id="cb15-9" data-line-number="9"></a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="co"># Create a plot of the model overview</span></a>
<a class="sourceLine" id="cb15-11" data-line-number="11">mSet&lt;-<span class="kw">PlotOPLS.MDL</span>(mSet, <span class="st">&quot;opls_mdl_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb15-12" data-line-number="12"></a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="co"># Perform and plot oPLS-DA permutation </span></a>
<a class="sourceLine" id="cb15-14" data-line-number="14">mSet&lt;-<span class="kw">OPLSDA.Permut</span>(mSet, <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb15-15" data-line-number="15">mSet&lt;-<span class="kw">PlotOPLS.Permutation</span>(mSet, <span class="st">&quot;opls_perm_2_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>)</a></code></pre></div>
</div>
<div id="significance-analysis-of-microarrary-and-metabolites-sam" class="section level2">
<h2>2.11 Significance Analysis of Microarrary (and Metabolites) (SAM)</h2>
<p>SAM is a well-established statistical method for identification of differentially expressed genes in mi- croarray data analysis. It is designed to address the false discovery rate (FDR) when running multiple tests on high-dimensional microarray data. SAM assigns a significance score to each variable based on its change relative to the standard deviation of repeated measurements. For a variable with scores greater than an adjustable threshold, its relative difference is compared to the distribution estimated by random permutations of the class labels. For each threshold, a certain proportion of the variables in the permutation set will be found to be significant by chance. The proportion is used to calculate the FDR. SAM is performed using the <em>siggenes</em> package. Users need to specify the Delta value to control FDR in order to proceed. To begin the SAM analysis, use the <em>SAM.Anal</em> function. Please refer to the user manual for further details on the functions.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co"># Perform SAM analysis</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">mSet&lt;-<span class="kw">SAM.Anal</span>(mSet, <span class="st">&quot;d.stat&quot;</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="fl">0.0</span>, <span class="st">&quot;sam_imp_0_&quot;</span>)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3"></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="co"># Create a SAM plot of FDR values</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5">mSet&lt;-<span class="kw">PlotSAM.FDR</span>(mSet, <span class="st">&quot;sam_view_0_&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb16-6" data-line-number="6"></a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="co"># Create a SAM plot of results</span></a>
<a class="sourceLine" id="cb16-8" data-line-number="8">mSet&lt;-<span class="kw">PlotSAM.Cmpd</span>(mSet, <span class="st">&quot;sam_imp_0_&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>)</a></code></pre></div>
</div>
<div id="empirical-bayesian-analysis-of-microarray-and-metabolites-ebam" class="section level2">
<h2>2.12 Empirical Bayesian Analysis of Microarray (and Metabolites) (EBAM)</h2>
<p>EBAM is an empirical Bayesian method based on moderated t-statistics. EBAM uses a two-group mixture model for null and significant features. The prior and density parameters are estimated from the data. A feature is considered significant if its calculated posterior is larger than or equal to delta and no other features with a more extreme test score that is not called signicant. The default is delta = 0.9. The suggested fudge factor (a0) is chosen that leads to the largest number of significant features. EBAM is performed with ebam function in <em>siggenes</em> package.</p>
<p>To perform EBAM analysis, begin with the <em>EBAM.AO.Init</em> function. To create a plot of the EBAM analysis, use <em>PlotEBAM.AO</em>. Please refer to the user manual for further details on the functions.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="co"># Perform EBAM analysis</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2">mSet&lt;-<span class="kw">EBAM.Init</span>(mSet, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="fl">-99.0</span>, <span class="fl">0.9</span>, <span class="st">&quot;ebam_view_0_&quot;</span>, <span class="st">&quot;ebam_imp_0_&quot;</span>)</a>
<a class="sourceLine" id="cb17-3" data-line-number="3"></a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="co"># Plot EBAM analysis</span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5">mSet&lt;-<span class="kw">PlotEBAM.Cmpd</span>(mSet, <span class="st">&quot;ebam_imp_0_&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>)</a></code></pre></div>
</div>
<div id="hierarchical-clustering-dendogram" class="section level2">
<h2>2.13 Hierarchical Clustering: Dendogram</h2>
<p>In (agglomerative) hierarchical cluster analysis, each sample begins as a separate cluster and the algo- rithm proceeds to combine them until all samples belong to one cluster. Two parameters need to be considered when performing hierarchical clustering. The first one is distance measure, including the Euclidean distance, Pearson’s correlation, or Spearman’s rank correlation. The other parameter is the clustering algorithm, which includes the average linkage (clustering uses the centroids of the observations), complete linkage (clustering uses the farthest pair of observations between the two groups), single linkage (clustering uses the closest pair of observations) and Ward’s linkage (clustering to minimize the sum of squares of any two clusters). Heatmap is often presented as a visual aid in addition to the dendrogram. Hierachical clustering is performed with the <em>hclust</em> function in package stat. Use the <em>PlotHCTree</em> to create the dendogram, where users can specify the distance measure and the clustering algorithm. Please refer to the user manual for further details on the function.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co"># Perform hierarchical clustering and plot dendogram</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2">mSet&lt;-<span class="kw">PlotHCTree</span>(mSet, <span class="st">&quot;tree_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>, <span class="st">&quot;euclidean&quot;</span>, <span class="st">&quot;ward.D&quot;</span>)</a></code></pre></div>
</div>
<div id="hierarchical-clustering-heatmaps" class="section level2">
<h2>2.14 Hierarchical Clustering: Heatmaps</h2>
<p>The heatmap provides intuitive visualization of the metabolomics data table. Each colored cell on the map corresponds to a concentration value in the user’s data table, with samples in rows and features/compounds in columns. Users can use a heatmap to identify samples/features that are unusually high/low. Further, the heatmap is often presented as a visual aid in addition to the dendrogram.</p>
<p>In (agglomerative) hierarchical cluster analysis, each sample begins as a separate cluster and the algorithm proceeds to combine them until all samples belong to one cluster. Two parameters need to be considered when performing hierarchical clustering. The first one is the similarity measure, options in MetaboAnalystR include Euclidean distance, Pearson’s correlation, and Spearman’s rank correlation. The other parameter is the choice of clustering algorithms, including average linkage (clustering uses the centroids of the observations), complete linkage (clustering uses the farthest pair of observations between the two groups), single linkage (clustering uses the closest pair of observations) and Ward’s linkage (clustering to minimize the sum of squares of any two clusters). Hierachical clustering is performed with the <em>hclust</em> function in package stat. Use the <em>PlotHeatMap</em> function, where users can specify the distance measure, the clustering algorithm, the color contrast, a detailed or overview view of the data, and options for the data input for the heatmap. Please refer to the user manual for further details.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co"># Perform hierarchical clustering and plot heat map</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2">mSet&lt;-<span class="kw">PlotHeatMap</span>(mSet, <span class="st">&quot;heatmap_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>, <span class="st">&quot;norm&quot;</span>, <span class="st">&quot;row&quot;</span>, <span class="st">&quot;euclidean&quot;</span>, <span class="st">&quot;ward.D&quot;</span>,<span class="st">&quot;bwm&quot;</span>, <span class="st">&quot;overview&quot;</span>, T, T, <span class="ot">NA</span>, T, F)</a></code></pre></div>
</div>
<div id="partitional-clustering-k-means" class="section level2">
<h2>2.15 Partitional Clustering: K-Means</h2>
<p>K-means clustering is a nonhierarchical clustering technique. It begins by creating k random clusters (k is supplied by user). The program then calculates the mean of each cluster. If an observation is closer to the centroid of another cluster then the observation is made a member of that cluster. This process is repeated until none of the observations are reassigned to a different cluster. K-means analysis is performed using the <em>kmeans</em> function in the package <em>stat</em>. To begin, use the <em>Kmeans.Anal</em> function, and then the <em>PlotKmeans</em> function to create a plot of the analysis.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co"># Perform K-means analysis</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2">mSet&lt;-<span class="kw">Kmeans.Anal</span>(mSet, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb20-3" data-line-number="3"></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="co"># Plot K-means analysis </span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5">mSet&lt;-<span class="kw">PlotKmeans</span>(mSet, <span class="st">&quot;km_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>)</a></code></pre></div>
</div>
<div id="partitional-clustering-self-organizing-maps-som" class="section level2">
<h2>2.16 Partitional Clustering: Self Organizing Maps (SOM)</h2>
<p>SOM is an unsupervised neural network algorithm used to automatically identify major trends present in high-dimensional data. SOM is based on a grid of interconnected nodes, each of which represents a model. These models begin as random values, but during the process of iterative training they are updated to represent different subsets of the training set. Users need to specify the x and y dimension of the grid to perform SOM analysis. The SOM is performed using the <em>som</em> R package. Please refer to the user manual for further details on the functions.</p>
<p>MetaboAnalystR performs several outputs for self organizing maps. To begin, use the <em>SOM.Anal</em> function to perform SOM analysis. Then use the <em>PlotSOM</em> to create a plot of the SOM analysis.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co"># Perform SOM analysis</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">mSet&lt;-<span class="kw">SOM.Anal</span>(mSet, <span class="dv">1</span>, <span class="dv">3</span>,<span class="st">&quot;linear&quot;</span>,<span class="st">&quot;gaussian&quot;</span>)</a>
<a class="sourceLine" id="cb21-3" data-line-number="3"></a>
<a class="sourceLine" id="cb21-4" data-line-number="4"><span class="co"># Plot SOM analysis</span></a>
<a class="sourceLine" id="cb21-5" data-line-number="5">mSet&lt;-<span class="kw">PlotSOM</span>(mSet, <span class="st">&quot;som_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>)</a></code></pre></div>
</div>
<div id="random-forest" class="section level2">
<h2>2.17 Random Forest</h2>
<p>Random Forest is a supervised learning algorithm suitable for high dimensional data analysis. It uses an ensemble of classification trees, each of which is grown by random feature selection from a bootstrap sample at each branch. Class prediction is based on the majority vote of the ensemble. RF also provides other useful information such as OOB (out-of-bag) error, variable importance measure, and outlier mea- sures. During tree construction, about one-third of the instances are left out of the bootstrap sample. This OOB data is then used as test sample to obtain an unbiased estimate of the classification error (OOB error). Variable importance is evaluated by measuring the increase of the OOB error when it is permuted. The outlier measures are based on the proximities during tree construction. RF analysis is performed using the <em>randomForest</em> R package.</p>
<p>MetaboAnalystR performs several outputs for the random forest analysis. To begin, use the <em>RF.Anal</em> function. The <em>PlotRF.Classify</em> function creates a plot of the out-of-the-bag error rate for the random forest classification. The <em>PlotRF.VIP</em> function creates a plot of the contributions of variables with high importance to the classification of the random forest model. In this plot, the features are ranked by their contributions to classification accuracy (Mean Dicrease Accuracy). The <em>PlotRF.Outlier</em> creates a plot of the outlying samples in the random forest model.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="co"># Perform random forest analysis</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2">mSet&lt;-<span class="kw">RF.Anal</span>(mSet, <span class="dv">500</span>, <span class="dv">7</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb22-3" data-line-number="3"></a>
<a class="sourceLine" id="cb22-4" data-line-number="4"><span class="co"># Plot random forest classification</span></a>
<a class="sourceLine" id="cb22-5" data-line-number="5">mSet&lt;-<span class="kw">PlotRF.Classify</span>(mSet, <span class="st">&quot;rf_cls_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb22-6" data-line-number="6"></a>
<a class="sourceLine" id="cb22-7" data-line-number="7"><span class="co"># Plot random forest variables of importance</span></a>
<a class="sourceLine" id="cb22-8" data-line-number="8">mSet&lt;-<span class="kw">PlotRF.VIP</span>(mSet, <span class="st">&quot;rf_imp_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb22-9" data-line-number="9"></a>
<a class="sourceLine" id="cb22-10" data-line-number="10"><span class="co"># Plot random forest outliers </span></a>
<a class="sourceLine" id="cb22-11" data-line-number="11">mSet&lt;-<span class="kw">PlotRF.Outlier</span>(mSet, <span class="st">&quot;rf_outlier_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>)</a></code></pre></div>
</div>
<div id="support-vector-machine-svm" class="section level2">
<h2>2.18 Support Vector Machine (SVM)</h2>
<p>SVM aims to find a nonlinear decision function in the input space by mapping the data into a higher dimensional feature space and separating it there by means of a maximum margin hyperplane. The SVM- based recursive feature selection and classification is performed using the R-SVM script11. The process is performed recursively using decreasing series of feature subsets (ladder) so that different classification models can be calculated. Feature importance is evaluated based on its frequencies being selected in the best classifier identified by recursive classification and cross-validation. Please note, R-SVM is very computationally intensive. Only the top 50 features (ranked by their p values from t-tests) will be evaluated.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="co"># Perform SVM </span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2">mSet&lt;-<span class="kw">RSVM.Anal</span>(mSet, <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb23-3" data-line-number="3"></a>
<a class="sourceLine" id="cb23-4" data-line-number="4">mSet&lt;-<span class="kw">PlotRSVM.Classification</span>(mSet, <span class="st">&quot;svm_cls_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb23-5" data-line-number="5"></a>
<a class="sourceLine" id="cb23-6" data-line-number="6">mSet&lt;-<span class="kw">PlotRSVM.Cmpd</span>(mSet, <span class="st">&quot;svm_imp_0_&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">width=</span><span class="ot">NA</span>)</a></code></pre></div>
</div>
<div id="sweave-report" class="section level2">
<h2>3. Sweave Report</h2>
<p>Following analysis, a comprehensive report can be generated which contains a detailed description of each step performed in the R package, embedded with graphical and tabular outputs. To prepare the sweave report, please use the <em>PreparePDFReport</em> function. You must ensure that you have the nexessary Latex libraries to generate the report (i.e. pdflatex, LaTexiT). The object created <em>must</em> be named <em>mSet</em>, and specify the user name in quotation marks.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw">PreparePDFReport</span>(mSet, <span class="st">&quot;My Name&quot;</span>)</a></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
